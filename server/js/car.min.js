"use strict";var _createClass=function(){function l(e,t){for(var n=0;n<t.length;n++){var l=t[n];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}return function(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}$("#top").load("index.html #top"),$("header").load("index.html header"),$("#nav").load("index.html #nav"),$("footer").load("index.html footer");var Car=function(){function t(e){_classCallCheck(this,t),this.url=e.url,this.tbody=e.tbody,this.dele=e.dele,this.allnum=e.allnum,this.allprice=e.allprice,this.tab=e.tab,this.allcheck=e.allcheck,this.Allnum=0,this.load(),this.addEvent()}return _createClass(t,[{key:"load",value:function(){var t=this;ajax({url:this.url,success:function(e){t.res=JSON.parse(e),t.getCookie()}})}},{key:"getCookie",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){this.goods=JSON.parse(getCookie("goods")),this.display()})},{key:"display",value:function(){for(var e=[],t=0;t<this.res.length;t++)for(var n=0;n<this.goods.length;n++)this.res[t].goodsId==this.goods[n].id&&(e+='<tr>\n\t\t\t\t\t\t\t\t\t\t<td><input type="checkbox" class="checkes" name="checks" id="check"  value="" checked /></td>\n\t\t\t\t\t\t\t\t\t\t<td><img src="'+this.res[t].src+'"/></td>\n\t\t\t\t\t\t\t\t\t\t<td>'+this.res[t].name+'</td>\n\t\t\t\t\t\t\t\t\t\t<td>¥<span class="myprice">'+this.res[t].price+'</span></td>\n\t\t\t\t\t\t\t\t\t\t<td><input type="number" value="'+this.goods[n].num+'" min = 1 class = "mynum"></td>\n\t\t\t\t\t\t\t\t\t\t<td><em data-index="'+this.res[t].goodsId+'">删除</em></td>\n\t\t\t\t\t\t\t\t\t</tr>');this.tbody.innerHTML=e;for(var l=0,a=0,o=0;o<$(".checkes").length;o++)1==$(".checkes")[o].checked&&(l+=parseInt($(".mynum")[o].value),$("#allnum").html(l),a+=$(".myprice")[o].innerHTML*$(".mynum")[o].value,$("#allprice").html(a))}},{key:"addEvent",value:function(){var d=this;this.tbody.addEventListener("input",function(e){var t=e||window.event;if("number"==t.target.type&&1==t.target.parentNode.parentNode.children[0].children[0].checked){d.value=t.target.value,d.id=t.target.parentNode.nextElementSibling.children[0].getAttribute("data-index"),d.changeCookie(function(e){d.goods[e].num=d.value});for(var n=d.Allnum=0;n<d.goods.length;n++)d.Allnum+=parseInt(d.goods[n].num);d.allnum.innerHTML=d.Allnum}}),this.dele.addEventListener("click",function(){d.tbody.innerHTML="",console.log(d.goods),removeCookie(document.cookie)}),this.tbody.addEventListener("click",function(e){for(var t=e||window.event,n=0,l=0;l<d.goods.length;l++)for(var a=0;a<d.res.length;a++)d.res[a].goodsId==d.goods[l].id&&(n+=parseInt(d.res[a].price*d.goods[l].num));if(d.allprice.innerHTML=n,"EM"!=t.target.nodeName){for(var o=0,c=0,r=0;r<$(".checkes").length;r++)0==$(".checkes")[r].checked&&($("#allcheck")[0].checked=!1);for(r=0;r<$(".checkes").length;r++)1==$(".checkes")[r].checked&&(o+=parseInt($(".mynum")[r].value),$("#allnum").html(o),c+=$(".myprice")[r].innerHTML*$(".mynum")[r].value,$("#allprice").html(c));if(0==o)for(r=0;r<$(".checkes").length;r++)$("#allnum").html(o),$("#allprice").html(c)}if("EM"==t.target.nodeName){d.id=t.target.getAttribute("data-index"),t.target.parentNode.parentNode.remove(),d.changeCookie(function(e){d.goods.splice(e,1)});var i=0,s=0;for(r=0;r<$(".checkes").length;r++)1==$(".checkes")[r].checked&&(i+=parseInt($(".mynum")[r].value),$("#allnum").html(i),s+=$(".myprice")[r].innerHTML*$(".mynum")[r].value,$("#allprice").html(s))}}),$("#allcheck").on("click",function(){var e=0,t=0;if(1==$("#allcheck")[0].checked)for(var n=0;n<$(".checkes").length;n++)$(".checkes")[n].checked=!0;for(n=0;n<$(".checkes").length;n++)1==$(".checkes")[n].checked&&(e+=parseInt($(".mynum")[n].value),$("#allnum").html(e),t+=$(".myprice")[n].innerHTML*$(".mynum")[n].value,$("#allprice").html(t))})}},{key:"changeCookie",value:function(e){for(var t=0;t<this.goods.length&&this.goods[t].id!=this.id;t++);e(t),setCookie("goods",JSON.stringify(this.goods))}}]),t}();new Car({url:"./data/goods.json",tbody:document.getElementById("tbody"),dele:document.getElementById("dele"),allnum:document.getElementById("allnum"),allprice:document.getElementById("allprice"),tab:document.getElementById("tab"),allcheck:document.getElementById("allcheck")});